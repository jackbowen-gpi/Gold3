[pytest]
# Pytest configuration
python_files = tests.py test_*.py *_tests.py
addopts = --strict-config --disable-warnings --tb=short --cov=. --cov-report=html --cov-report=term-missing --cov-report=xml

# Django settings
DJANGO_SETTINGS_MODULE = gchub_db.test_settings
django_find_project = true
django_debug_mode = true

# Test discovery
testpaths = tests gchub_db/tests
norecursedirs = backups backend bin includes xml_io .history .venv .git .github __pycache__ .mypy_cache .pytest_cache .ruff_cache

# Coverage configuration - PRODUCTION CODE ONLY
[coverage:run]
# Only measure coverage on actual production application code
source =
    gchub_db  # Main Django application package (models, views, business logic)
    apps      # Django apps with business logic (workflow, accounts, etc.)

# Exclude everything that's not production application code
omit =
    # Test files (never include in coverage - these are testing the code, not the code itself)
    */tests/*
    */test_*.py
    */conftest.py
    test_*.py
    conftest.py

    # Generated/database files
    */migrations/*
    */__pycache__/*
    */fixtures/*
    *.pyc

    # Infrastructure and tools (not application code)
    bin/*
    scripts/*
    tools/*
    daemons/*
    deploy/*
    dev/*
    docker/*
    grafana/*
    prometheus/*
    launchd/*
    logs/*
    var/*

    # Static assets and templates
    staticfiles/*
    media/*
    templates/*
    html/*
    frontend/*

    # Configuration and documentation
    config/*
    docs/*
    *.md
    README*

    # Dependencies and virtual environment
    .venv/*
    .tox/*
    includes/*
    middleware/*
    templatetags/*

    # Django management and setup
    manage.py
    setup.py
    settings.py
    urls.py
    wsgi.py
    asgi.py

[coverage:report]
exclude_lines =
    pragma: no cover
    def __repr__
    if self.debug:
    if settings.DEBUG
    raise AssertionError
    raise NotImplementedError
    if 0:
    if __name__ == .__main__.:
    class .*\bProtocol\):
    @(abc\.)?abstractmethod

# Markers for different test types
markers =
    unit: Unit tests (fast, isolated)
    integration: Integration tests (slower, with dependencies)
    smoke: Basic smoke tests for CI
    slow: Slow-running tests
    external: Tests requiring external services
    mock: Tests using mock systems

# Filter warnings
filterwarnings =
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning
    ignore::UserWarning

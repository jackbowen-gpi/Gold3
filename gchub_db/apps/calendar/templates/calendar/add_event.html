{% extends "standard.html" %}

{% block page_title %}Add Event{% endblock %}

{% block extra_extra_head %}
<link rel="stylesheet" type="text/css" href="{{YUI_URL}}build/container/assets/container.css" />
<script type="text/javascript" src="{{YUI_URL}}build/yahoo-dom-event/yahoo-dom-event.js"></script>
<script type="text/javascript" src="{{YUI_URL}}build/animation/animation-min.js"></script>
<script type="text/javascript" src="{{YUI_URL}}build/container/container-min.js"></script>
<script type="text/javascript" src="{{MEDIA_URL}}js/workflow/job_detail.js"></script>
<script type="text/javascript">
function event_save(year_num, month_num) {
   /*
    * Fired when he user hits the Add Event button. Calls the validator
    * and sends off an AJAX request if all is good.
    */
   YAHOO.example.container.wait.show();
   new Ajax.Request('/calendar/event/save/', {
       method: 'POST',
       parameters: Form.serialize('event'),
       onSuccess: function(http_req) {
           // Get a JSON object from the response string (from the server).
           jsobj = http_req.responseText.evalJSON();
           // See if there was a form processing error.
           if (jsobj["is_error"] == false) {
                  window.location = "/calendar/month/" + year_num +"/" + month_num + "/"
           } else {
               // Form validation error happened.
               //hide_modal_wait();
               //If there is an error then get rid of the updating bar
               YAHOO.example.container.wait.hide();
               alert(jsobj["message"]);
               YAHOO.example.container.wait.hide();
           }
       },
       onComplete: function() {
          hide_modal_wait();
   }});
} // end add_event()
</script>

<!-- only run this if the current user is not a manager -->

<script type="text/javascript" src="{{MEDIA_URL}}js/jquery/js/jquery-1.8.3.js"></script>
<script type="text/javascript">
    jQuery.noConflict();

    jQuery(document).ready(function(){

    {% if not manager %}
    	jQuery("#for_employee_override").hide();
        jQuery("#id_type option[value='SD']").remove();
        jQuery("#id_type option[value='SH']").remove();
    {% endif %}

    });
</script>


{% endblock %}

{% block body %}
<h1 class="inline">Add Event Occuring on {{month}}-{{day}}-{{year}} for {{ user.first_name }} {{ user.last_name }}</h1>
	<form id="event" name="event" onsubmit="event_save('{{year}}', '{{month}}');return false;">
	<input type="hidden" name="event_date" id="event_date" value="{{year}}-{{month}}-{{day}}">
	<input type="hidden" name="employee" id="employee" value="{{ user.id }}">
		<br />
		<p><label for="id_type">Type of Event:</label>
            {{ eventform.type }}</p>
		<p><label for="id_description">Description:</label>
			{{ eventform.description }}</p>
		<p><label for="id_eventlength">Length of Event:</label>
			{{ eventform.eventlength }}<span class="smtext">(Total number of days event lasts.)</span></p>
		<p><label for="id_email_notice">Send Email Notice?:</label>
            {{ eventform.email_notice }}</p>
        <p><label for="id_time_start">Starting Time:</label>
            {{ eventform.time_start_hour }}{{ eventform.time_start_min }}</p>
		<p><label for="id_time_end">Ending Time:</label>
            {{ eventform.time_end_hour }}{{ eventform.time_end_min }}</p>
        <p id="for_employee_override"><label for="id_employee_override">Employee:</label>
            {{ eventform.employee_override }}<span class="smtext">(Leave blank to default to yourself.)</span></p>
        <br />
		<input type="submit" value="Add Event" onclick="event_save('{{year}}', '{{month}}');return false;" />
	</form>
	<div class="outline" style="width:325px">
		<img src="{{MEDIA_URL}}img/icons/information.png" style="vertical-align: text-bottom" /> Length of event will work properly if the event spans multiple months. Events now automatically skip weekends.
	</div>
{% endblock %}
